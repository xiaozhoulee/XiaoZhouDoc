# 第03节：微信签名规则

### 一、概述

为了让微信接口的调用更加安全，微信服务器要对支付接口和JS-SDK接口进行加密和校验。因此开发调取微信支付和JS-SKD接口，必须了解微信签名的规则。

### 二、规则

1. 确定参与签名的字段，例如noncestr、timestamp等。 
2. 对所有待签名参数按照字段名的 ASCII 码从小到大排序（字典序）后，使用 URL 键值对的格式（即key1=value1&key2=value2…）拼接成字符串string。这里需要注意的是所有参数名均为小写字符。
3. 接下来对拼接好的string作sha1加密，字段名和字段值都采用原始值，不进行URL转义。即signature=sha1(string1)。

通过上面的三步，就可以拿到签名的结果signature。

### 三、node中的签名算法。

在node中，通过下面的算法，可以得到签名结果。

``` js
getSign(signParams) {
  var keys = Object.keys(signParams);
  keys = keys.sort();
  var newArgs = {};
  keys.forEach(function (val) {
      if (signParams[val]) {
          newArgs[val] = signParams[val];
      }
  })
  var string = queryString.stringify(newArgs);
  return crypto.createHash('sha1').update(queryString.unescape(string), 'utf8').digest("hex");
}
```

上诉算法可以将一个字段的集合按照签名规则计算出签名结果，参数为一个对象，对象中包含了所有字段，示例如下所示：

``` js
{
   jsapi_ticket: jsapi_ticket,
   timestamp: timestamp,
   noncestr: nonceStr,
   url: "http://www.xiaozhoubg.com/phone"
}
```

### 三、总结

本章讲解了微信签名的目标和方法，了解了签名，我们便可以在后续的章节中调用JS-SDK和微信支付接口了。