# 第01节：文件打开关闭读写

### 本节目标

- 文件操作的作用
- 文件的基本操作
  - 打开
  - 读写
  - 关闭
- 文件备份
- 文件和文件夹的操作

### 一、文件操作的作用
#### 1、文件是什么？   
文件有很多种类，例如我们比较常用的 txt、md、png、MP3等都统称为文件。  
如下图所示   
![](../images/0501_img1.png)
#### 2、文件操作都包括什么？
文件操作包括文件的打开、关闭、读、写、复制......
#### 3、文件操作的作用是什么？
读取内容、写入内容、备份内容......

> 总结：文件操作的作用就是把一些内容(数据)存放起来，可以让程序下一次执行的时候直接使用，而不必重新制作一份，省时省力。
### 二、文件的基本操作

#### 1、文件的操作步骤
- 打开文件
- 读取、写入文件
- 关闭文件

> 可以只进行打开关闭文件，而不进行读写。
#### 2、打开文件
在Python中可以使用open函数打开一个已存在的文件，或创建一个新文件，语法如下：  
``` python
open(name, mode)
```

name：可以理解为是你打开文件的名字（文件的路径也可以）  

mode：意思设置你打开文件的格式：只读、只写、追加等...
#### 3、打开文件模式

| 模式 | 描述                                                         |
| :--: | ------------------------------------------------------------ |
|  r   | 以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。 |
|  rb  | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。 |
|  r+  | 打开一个文件用于读写。文件指针将会放在文件的开头。           |
| rb+  | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。 |
|  w   | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
|  wb  | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
|  w+  | 打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| wb+  | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
|  a   | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
|  ab  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
|  a+  | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |
| ab+  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |

文件指针的意思我们可以通俗的理解为文件指针就是鼠标光标的位置   

我们本节只需要学习三总主访问模式：   
- r 只对文件进行查看  
- w 只对文件进行写入  
- a 对文件进行追加 
``` python
# r 支持访问，无法进行写入操作
# w 只能对文件进行写入，执行写入后会覆盖上次写入的内容并且无法进行追加操作，如果写入的文件不存在，则会新建一个该文件
# a 只对文件进行追加，追加的数据在最后面，如果追加的文件不存在，则会新建一个该文件

````
#### 4。快速体验
``` python
f = open('text.txt','w')

> 把open函数赋值到一个变量，这个被赋值的变量就是文件对象
> 注意：此时的`f`是`open`函数的文件对象。
> 文件对象可以随机命名，只需要符合命名规范就行
```
#### 5、文件对象写法
- 语法

``` python
文件对象.write('内容')
```
- 实例

``` python
# 以“w” 的模式打开一个名为text的为文件，文件存在直接打开，文件不存在则自动创建一个
f = open('text.txt','w')

# 2.文件写入  ------ 只能写入英文
f.write('hello world')

# 3、关闭文件
f.close()
```
> 注意：
> 1. `w	`和`a`模式：如果文件不存在则创建该文件；如果文件存在，`w`模式先清空再写入，`a`模式直接末尾追加。
> 2. `r`模式：如果文件不存在则报错。
> 3. 访问模式可以省略不写，默认为“r”模式

- utf-8
python读写文件时，默认使用的编码为平台编码，也就是gbk。而在pycharm中创建的文件默认使用的是utf-8编码。所以如果直接写入中文会出现你输入的文字变成乱码的情况。遇到这种情况我们只需要指定编码为utf-8就可以解决该问题。    
``` python
# 指定编码为utf-8
f = open('text.txt','w',encoding = 'utf-8')

f.write('你好中国') # 可以输出中文

f.close()
```
#### 6、文件的读取
- read()

语法：   
``` python
文件对象.read(num)

# num表示要从文件中读取的数据的长度（单位是字节），如果没有传入num，那么就表示读取文件中所有的数据。
```
实例：   
``` python
# 查看text文件，用r只读的方式
f = open('text.txt','r')
# 打印text文件里所有的内容
print(f.read())
# 关闭文件
f.close()
```

- readlines()

readlines可以按照行的方式把整个文件中的内容进行一次性读取，并且返回的是一个列表，其中每一行的数据为一个元素。  

实例：  
``` python
# 在练习readlines之前我们先把text里面的数据换成aaaa\n,bbbb\n,cccc\n,dddd\n,方便测试
# f = open('text.txt','w')
# f.write('aaaa,bbbb,cccc,dddd')
# f.close()


# 查看text文件
f = open('text.txt')
# 新建一个变量保存f.readlines()的数据
content = f.readlines()
# 打印结果  ---- 会把换行符也打印出来
print(content) # ['aaaa\n', 'bbbb\n', 'cccc\n', 'dddd\n']
# 关闭文件
f.close()
```
- readline()

readline() 每次只能读取一行内容。

实例：   
``` python
f = open('text.txt')

# 打印第一行
content = f.readline()
print(content)

# 打印第二行
content = f.readline()
print(content)
# 关闭文件
f.close()
```
#### 7、seek()

作用：用来改变文件指针的位置。     

语法：   
``` python
文件对象.seek(偏移量, 起始位置)
# 偏移量代表你要把文件指针改变到第几行
# 起始位置代表的是文件指针的初始位置
```
> 起始位置：
>
> - 0：文件开头
> - 1：当前位置
> - 2：文件结尾

实例：   
``` python
'''
目标：
    1、改变打开方式‘r’，让他改变读取数据位置
    2、改变打开方式’a‘，让他能够读取数据
    3、我们用r+和a+的方式来测试
'''
# 实例一

f = open('text.txt','r+')

# 改变位置，把文件指针放到第三个数据前
f.seek(0,2)
# 打印结果
con = f.read()
print(con)  # 前两个a不打印
# 关闭文件
f.close()

# 实例二
f = open('text.txt','a+')

# 改变位置，把起始位置变成0（文件开头）
f.seek(0,0)
# 打印结果
con = f.read()
print(con)  # 可以打印出结果
# 关闭文件
f.close()

# 注：如果偏移量和起始位置都0的话可以只写一个0
```
#### 8、关闭
```open
文件对象.close()
```
### 三、文件备份

需求：用户输入当前目录下任意文件名，程序完成对该文件的备份功能(备份文件名为xx[备份]后缀，例如：test[备份].txt)。

#### 1、步骤

1. 接收用户输入的文件名
2. 规划备份文件名
3. 备份文件写入数据

#### 2、代码实现

1. 接收用户输入的文件名
``` python
fil_name = input('请输入您要备份的文件名：')
```
2. 规划备份文件名
``` python
# 找到文件后缀面名的 . 的下标，并赋值给index变量 --- rfind的作用是在字符串中查找某个子串 
index = fil_name.rfind('.') 
# print(index) # 求出后缀名 . 的下标位置是数字几
#  组织新名字，新名字等于原名子 + [备份] + [后缀名]
# fil_name[:ubdex]的意思是求出下标从0到几的数据，index的数字由上面求出的后缀名的 . 的数字来决定
new_name = fil_name[:index] + '[备份]' + fil_name[index:] 
print(new_name) 
```
3. 备份文件写入数据
``` python
old_f = open(fil_name, 'rb') # 新建一个文件对象，并打开文件位置
new_f = open(new_name, 'wb') # 新建一个文件对象，并打开文件位置
while True:  # 新建一个while循环
    con = old_f.read() # 读取old_f里所有的内容并赋值给变量con
    if len(con) == 0: # 使用if判断，求出变量con的字符长度并判断old_f数据是否等于0，不等于0继续循环，等于0则终止循环
        break
    new_f.write(con) # 把old_f里的数据赋值给new_f（写入）
old_f.close() # 关闭文件
new_f.close() # 关闭文件
````
#### 3、拓展
如果用户输入的是‘.txt’这种的无效文件名，程序该如何更改才能限制只有有效的文件名才能备份？   
答：新添加一个条件判断就可以了。   
``` python
fil_name = input('请输入您要备份的文件名：')
index = fil_name.rfind('.')
# 判断index是否大于0，大于0代码正常执行，否则报错
if index>0:
    postfix = fil_name[index:]
new_name = fil_name[:index] + '[备份]' + postfix
# print(new_name)
old_f = open(fil_name, 'rb')
new_f = open(new_name, 'wb')
while True:
    con = old_f.read()
    if len(con) == 0:
        break
    new_f.write(con)
old_f.close()
new_f.close()
```
### 四、文件和文件夹操作
#### 1、模块
在Python中文件和文件夹的操作要借助os模块里面的相关功能，具体步骤如下：

1. 导入os模块

``` python
import os
```

2. 使用`os`模块相关功能

``` python
os.函数名()
```
#### 2、文件重命名
``` python
os.rename(目标文件名, 新文件名)
```
实例：  
``` python
# 导入os模块
import os
# 把text[备份].txt改为zzz.txt
os.rename('text[备份].txt','zzz.txt')
```
#### 3、删除文件
``` python
os.remove(目标文件名)
```
实例：   
``` python
# 导入os模块
import os
# 删除zzz.txt这个文件
os.remove('zzz.txt')

# 注意：在使用删除时要把上面的改文件名的代码注释一下，否则会出现报错的情况
```
#### 4、创建文件夹
``` python
os.mkdir(文件夹名字)
```
实例：   
``` python
# 导入模块
import os
# 创建一个名为高考复习题的文件夹
os.mkdir('高考复习题')
```
#### 5、删除文件夹
``` python
os.rmdir(文件夹名字)
```
实例：   
``` python
# 导入模块
import os
# 删除名为高考复习题的文件夹
os.rmdir('高考复习题')
```
#### 6、获取当前目录
会返回当前文件所在的路径
``` python
os.getcwd()
```
实例：  
``` python
import os
# 返回当前所在目录，打印的结果就是你当前文件的路径
print(os.getcwd()) #  C:\Users\烽霸\PycharmProjects\untitled2
```
> 想要看结果必须要用print打印
#### 7、改变默认目录
``` python
os.chdir(目录)
```
实例：  
``` python
# 需求：创建一个aa文件夹，再在aa里面创建一个bb文件夹

# 创建aa文件夹
os.mkdir('aa')
# 改变路径，把默认路径换成aa
os.chdir('aa')
# 创建bb文件夹
os.mkdir('bb')
```

#### 8、获取目录列表
获取某个文件下所有的文件并返回一个列表
``` python
os.listdir(目录)
```
> 书写获取目录列表时，你的文件和要获取的文件夹要同级，否则会报错
实例：  
``` python
import os
# 获取aa文件夹里的所有目录
print(os.listdir('aa'))
```
#### 9、重命名文件夹
rename也可以用来重命名文件夹  
  
``` pyhton
os.rename(目标文件夹名, 新文件夹名)
```

实例：  
``` python
import os
# 把aa文件夹的命名改成aaaa
os.rename('aa','aaaa')
```
### 五、综合案例

需求：批量修改文件名、删除指定字符串  

实例：  
``` python
# 需求1：把当前文件夹所有的文件格式都改变成：python_xxx
# 需求2：可以通过删除文件夹名字内的字符串来更改名字
import os

# 构造条件数据
flag = 1

# 找到所有文件，获取当前文件夹目录
file_list = os.listdir()
print(file_list)

# 构造名字
for i in file_list:
    # 当flag全等于1时执行下面代码
    if flag == 1:
        new_name = 'python_' + i # 新建一个变量，把添加的值赋值给他
        os.rename(i, new_name) # 更换名字
    # 当flag全等于2时执行下面代码
    elif flag == 2:
        num = len('python_') # 新建一个变量求出你要删除的字符串的长度
        new_name = i[num:] # 使用切片，删除字符串
        os.rename(i, new_name) # 更换名字
```
### 六、总结

- 文件操作步骤

  - 打开

  ``` python
  文件对象 = open(目标文件, 访问模式)
  ```

  - 操作

    - 读

    ``` python
    文件对象.read()
    文件对象.readlines()
    文件对象.readline()
    ```

    - 写

    ``` python
    文件对象.write()
    ```

    - seek()

  - 关闭

  ``` python
  文件对象.close()
  ```


- 主访问模式
  - w：写，文件不存在则新建该文件
  - r：读，文件不存在则报错
  - a：追加

- 文件和文件夹操作
  - 重命名：os.rename()
  - 获取当前目录：os.getcwd()
  - 获取目录列表：os.listdir()













