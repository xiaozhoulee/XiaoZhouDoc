# 第05节:Go语言基础之文件操作

##### 上一节我们讲述了Go语言标准库中的flag，这节我们来给大家讲解Go语言中读写文件操作。

### 一、打开和关闭文件操作

`os.Open()` 函数能够打开一个文件，返回`*File`和一个`err`对得到的文件实例调用`close()`方法能够关闭文件。

```go
package main

import (
	"fmt"
	"os"
)

func main() {
	// 只读方式打开当前目录下的main.go文件
	file, err := os.Open("./main.go")
	if err != nil {
		fmt.Println("open file failed!, err:", err)
		return
	}
	// 关闭文件
	file.Close()
}
```

为了防止文件忘记关闭，我们通常使用defer注册文件关闭语句。

### 二、读取文件

##### file.Read()

**基本使用**

Read方法定义如下:

```go
func (f*File) Read(b []type) (n int, err error)
```

他接收了一个字节切片，返回读取的字节数和可能的具体错误，读到文件末尾时会返回`0`和`io.EOF`。举个例子:

```go
func main() {
	// 只读方式打开当前目录下的main.go文件
	file, err := os.Open("./main.go")
	if err != nil {
		fmt.Println("open file failed!, err:", err)
		return
	}
	defer file.Close()
	// 使用Read方法读取数据
	var tmp = make([]byte, 128)
	n, err := file.Read(tmp)
	if err == io.EOF {
		fmt.Println("文件读完了")
		return
	}
	if err != nil {
		fmt.Println("read file failed, err:", err)
		return
	}
	fmt.Printf("读取了%d字节数据\n", n)
	fmt.Println(string(tmp[:n]))
}
```

##### 循环读取

使用for循环读取文件中的所有数据

```go
func main() {
	// 只读方式打开当前目录下的main.go文件
	file, err := os.Open("./main.go")
	if err != nil {
		fmt.Println("open file failed!, err:", err)
		return
	}
	defer file.Close()
	// 循环读取文件
	var content []byte
	var tmp = make([]byte, 128)
	for {
		n, err := file.Read(tmp)
		if err == io.EOF {
			fmt.Println("文件读完了")
			break
		}
		if err != nil {
			fmt.Println("read file failed, err:", err)
			return
		}
		content = append(content, tmp[:n]...)
	}
	fmt.Println(string(content))
}
```

### 三、总结

Go语言中文件是什么呢？计算机中的文件是存储在外部介质(通常是磁盘)上的数据集合，文件分为文本和二进制文件。

### 四、作业

1. 练习本节按例

2. 借助`io.Copy`实现一个拷贝文件函数
